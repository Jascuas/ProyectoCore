
@model IEnumerable<Oberon.Models.Carro>
@section scripts{
    <script>
        int 
        function cambiarPrecio(input) {
            var precio = $(input.parentNode.parentNode).siblings()[3];
            
            $(precio).text((precio.dataset.value * $(input).val()).toFixed(2) + "€");
            $("#mensaje").text("Ha habido modificaciones en tu carrito!");
            $("#fin").addClass("disabled");
        }
    </script>
}
<div class="container my-5">
    <div class="card shopping-cart">
        <div class="card-header bg-dark text-light">
            <i class="fa fa-shopping-cart mt-2 pt-1" aria-hidden="true">  </i>
            Tu carrito

        </div>
        <div class="card-body ">

            @if (Model != null && Model.Count() > 0)
            {@using (Html.BeginForm())
                {
                    <div class=" table-responsive-sm table-responsive-md">
                        <table class="table table-hover ">
                            <thead>
                                <tr>
                                    <th></th>
                                    <th>Producto</th>
                                    <th>Talla</th>
                                    <th>Unidades</th>
                                    <th>Precio</th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tbody>

                                @Html.AntiForgeryToken()
                                @foreach (Carro c in Model)
                                {

                                    <tr>
                                        <td class="align-middle"><a asp-action="Tienda" asp-controller="Home" asp-route-id_Talla="@c.Talla.Id_Producto" class="thumbnail pull-left" > <img class=" rounded z-depth-2 img-fluid mr-3" src="~/images/Productos/@c.Producto.Imagen" style="max-width: 150px"> </a></td>
                                        <td class="align-middle">@c.Producto.Nombre<input type="hidden" id="id_talla" name="id_talla" class="text-hide" value="@c.Talla.Id_Talla"></td>
                                        <td class="align-middle">@c.Talla.Size</td>
                                        <td class="align-middle">
                                            <div class="def-number-input number-input m-0">
                                                <button type="button" onclick="this.parentNode.querySelector('input[type=number]').stepDown(), cambiarPrecio(this.parentNode.querySelector('input[type=number]'))" class="minus"></button>
                                                <input class="quantity" min="1" name="unidades" value="@c.unidades" type="number" oninput="cambiarPrecio(this)">
                                                <button type="button" onclick="this.parentNode.querySelector('input[type=number]').stepUp(), cambiarPrecio(this.parentNode.querySelector('input[type=number]'))" class="plus"></button>
                                            </div>
                                        </td>
                                        <td class="align-middle" id="@c.Talla.Id_Talla" data-value="@c.Producto.Precio">@(@c.Producto.Precio * @c.unidades)€</td>
                                        <td class="align-middle"><a asp-action="Carrito" asp-controller="Home" asp-route-id_Talla="@c.Talla.Id_Talla"><i class="fa fa-trash text-danger" aria-hidden="true"></i></a></td>
                                    </tr>
                                }


                            </tbody>
                        </table>
                        <button type="submit" class="btn btn-outline-primary  btn-sm">Actualizar carrito</button>

                        <div class="float-right" style="margin: 5px">
                            @*<h6 class="text-muted"> Codigo: <b><span id=""> FINOFILIPINO @ViewBag.Codigo</span></h6>
                        <h6 class="text-muted"> Descuento del: <b><span id="">20</span> %</b></h6>
                        <h6>Precio sin descuento: <b class="text-danger"><span>@ViewBag.Total</span> €</b> </h6>*@
                            <h5>Precio total: <b class="text-info"><span id="total">@ViewBag.Total</span> €</b></h5>
                        </div>
                    </div>
                }
                    <div class="card-footer">
                        @*<div class="coupon col-md-5 col-sm-5 ">
            <div class="row">
                <div class="col-6">
                    <input type="text" class="form-control" placeholder="cupone code">
                </div>
                <div class="col-6">
                    <input type="submit" class="btn btn-default" value="Use cupone">
                </div>
            </div>
        </div>*@
                        <div class="float-right">
                            <span id="mensaje" class="text-warning text-muted"></span>
                            <a asp-action="AñadirPedido" asp-controller="Home" class="btn btn-sm btn-outline-success" id="fin">Finalizar pedido</a>

                        </div>
                    </div>
        }else if (ViewBag.Mensaje != null)
            {
            <h4 class="modal-title text-success" id="myModalLabel">@ViewBag.Mensaje</h4>
            } else
            {
                <h4 class="modal-title text-warning" id="myModalLabel">Aun no has añadido productos al carrito</h4>
            }
        </div>


        
    </div>
</div>
